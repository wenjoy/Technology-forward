# Encode

## ç¼–ç -å­—ç¬¦é›†

è§„å®šæ–‡å­—ç¬¦åˆæ€ä¹ˆç¼–ç ï¼Œä¹Ÿå°±æ˜¯å„ç§è¯­è¨€çš„æ–‡å­—å’Œç¬¦å·æ€ä¹ˆç”¨äºŒè¿›åˆ¶è¡¨ç¤ºã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¯´çš„ç¼–ç ï¼Œè¯´çš„æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œåƒå›¾ç‰‡è§†é¢‘è¿™äº›ä¸åœ¨èŒƒå›´å†…ã€‚ç¬¦å·å¯¹åº”çš„æ•°å­—ï¼Œç§°ä¸ºç ç‚¹ã€‚æ¯”å¦‚`1`çš„ç ç‚¹æ˜¯`31`, ä¸­æ–‡`å¥½`çš„ç ç‚¹æ˜¯`597d`ï¼Œ ä¸¤ä¸ªå­—èŠ‚ã€‚

### ascii
1. ASCII ç ä¸€å…±è§„å®šäº†128ä¸ªå­—ç¬¦çš„ç¼–ç , åªå ç”¨äº†ä¸€ä¸ªå­—èŠ‚çš„åé¢7ä½ï¼Œæœ€å‰é¢çš„ä¸€ä½ç»Ÿä¸€è§„å®šä¸º0 
2. è¡¨ç¤ºè‹±æ–‡çš„å­—ç¬¦è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å…¶ä»–å›½å®¶çš„æ–‡å­—ç¬¦å·æ²¡åŠæ³•è¡¨ç¤º  

![](../assets/ascii.png)

### Unicode
1. æ–°çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥è¡¨ç¤ºéå¸¸å¤šçš„ç¬¦å·ï¼Œç°åœ¨çš„è§„æ¨¡å¯ä»¥å®¹çº³100å¤šä¸‡ä¸ªç¬¦å·ï¼Œ[å®˜ç½‘](unicode.org)  

## ç¼–ç -ç¼–ç æ–¹å¼

ä¸Šé¢è¯´çš„æ˜¯å­—ç¬¦é›†ï¼Œåªæ˜¯è§„å®šäº†æ•°å­—ï¼ˆäºŒè¿›åˆ¶ï¼‰å’Œå­—ç¬¦ä¹‹é—´çš„ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œä½†æ˜¯è½å®åˆ°è®¡ç®—æœºå‚¨å­˜ï¼Œå°±éœ€è¦è€ƒè™‘å®ç°çš„é—®é¢˜ã€‚è¿™äº›æ•°å­—ç”¨å‡ ä¸ªå­—èŠ‚ä¿å­˜ï¼Ÿå¯¹äºasciiæ¥è¯´ï¼Œè¿™å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯unicodeå­—ç¬¦é›†èŒƒå›´å¾ˆå¹¿ï¼Œå¾ˆå¤šå­—ç¬¦çš„ç ç‚¹éƒ½æ˜¯å¤§äº255ï¼Œä¸€ä¸ªå­—èŠ‚ä¸èƒ½è¡¨ç¤ºã€‚

ç”¨å¤šå­—èŠ‚è¡¨ç¤ºçš„è¯ï¼Œ æœ‰ä¸ªé—®é¢˜å¿…é¡»è§£å†³ï¼Œè®¡ç®—æœºæ€ä¹ˆçŸ¥é“ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œè¿˜æ˜¯åˆ†åˆ«è¡¨ç¤ºä¸‰ä¸ªç¬¦å·ï¼Ÿ

ç°åœ¨æœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼š
|ç¼–ç æ–¹å¼|bytes|
|--|:--|
|utf-8|1-4 ä¸ªå­—èŠ‚|
|utf-16|2 or 4 ä¸ªå­—èŠ‚|
|utf-32|ç»Ÿä¸€4ä¸ªå­—èŠ‚|

### UTF-8


|(åå…­è¿›åˆ¶)        |              ï¼ˆäºŒè¿›åˆ¶ï¼‰|
|--|--|
|0000 0000-0000 007F | 0xxxxxx|
|0000 0080-0000 07FF | 110xxxxx 10xxxxxx|
|0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx|
|0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx|

å¦‚æœå¼€å¤´æ˜¯1ï¼Œåˆ™è¡¨æ˜æ˜¯å¤šä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œå†çœ‹åé¢ä¸€ä¸ªå­—èŠ‚çš„å¼€å¤´ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ä¸Šé¢çš„é‚£ä¸ªé—®é¢˜ã€‚

### UTF-16

![](https://picb.zhimg.com/v2-00d7e0f8c532a2651e450ba7b93e0da7_r.jpg)  
UTF-16 ç”¨äºŒä¸ªå­—èŠ‚æ¥è¡¨ç¤ºåŸºæœ¬å¹³é¢ï¼Œç”¨å››ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºæ‰©å±•å¹³é¢

åœ¨è¿™ç§ç¼–ç æ–¹å¼ä¸‹ï¼Œä¸€ç§æƒ…å†µæ˜¯ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œå¦‚æœä¸è¶³çš„å°±ç”¨0è¡¥é½ï¼Œæ¯”å¦‚asciiå­—ç¬¦é›†é‡Œçš„é‚£äº›ç¬¦å·ã€‚è¿™æ ·ä¹Ÿå¯ä»¥åŒºåˆ†ï¼Œè§£å†³ä¸Šé¢çš„é‚£ä¸ªé—®é¢˜ã€‚

é‚£ä»€ä¹ˆæ—¶å€™ç”¨å››ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå‘¢ï¼Ÿåœ¨UTF-16ç¼–ç é‡Œï¼Œ``U+D800`åˆ°`U+DFFF`æ˜¯ä¸€ä¸ªç©ºæ®µï¼Œå³è¿™äº›ç ç‚¹ä¸å¯¹åº”ä»»ä½•å­—ç¬¦ã€‚æ‰©å±•å¹³é¢çš„å­—ç¬¦ä½å…±æœ‰2^20ä¸ªï¼ŒUTF-16å°†è¿™20ä½æ‹†æˆä¸¤åŠï¼Œå‰10ä½æ˜ å°„åœ¨U+D800åˆ°U+DBFFï¼ˆç©ºé—´å¤§å°210ï¼‰ï¼Œç§°ä¸ºé«˜ä½ï¼ˆHï¼‰ï¼Œå10ä½æ˜ å°„åœ¨U+DC00åˆ°U+DFFFï¼ˆç©ºé—´å¤§å°210ï¼‰ï¼Œç§°ä¸ºä½ä½ï¼ˆLï¼‰ç”¨æ¥æ˜ å°„æ‰©å±•å¹³é¢çš„å­—ç¬¦ã€‚æ¯”å¦‚'ğŒ†'å°±æ˜¯æ‰©å±•å¹³é¢çš„å­—ç¬¦ï¼Œç ç‚¹æ˜¯`U+1D306` ,é€šè¿‡è®¡ç®—å…¬å¼ï¼š

```javascript
H = Math.floor((c-0x10000) / 0x400)+0xD800

L = (c - 0x10000) % 0x400 + 0xDC00
```

å¯ä»¥å¾—åˆ°é«˜ä½å’Œä½ä½ :

```javascript
H = Math.floor((0x1D306-0x10000)/0x400)+0xD800 = 0xD834

L = (0x1D306-0x10000) % 0x400+0xDC00 = 0xDF06
```

å…¶ç¼–ç å°±æ˜¯0xD834 DF06ï¼Œé•¿åº¦ä¸ºå››ä¸ªå­—èŠ‚ã€‚

å¯ä»¥ç”¨jséªŒè¯å¦‚ä¸‹ï¼š

```js
'ğŒ†'.charCodeAt(0).toString(16) -> 'd834'
'ğŒ†'.charCodeAt(1).toString(16) -> 'df06'
```

æ‰€ä»¥å½“ç”¨charCodeAtå–åˆ°ç ç‚¹åœ¨`d800` ~`dfff` ä¹‹é—´ï¼Œæ¯”å¦‚è¿™é‡Œçš„`d834`ï¼Œæˆ‘ä»¬å°±çŸ¥é“åº”è¯¥è¿åé¢çš„å­—èŠ‚ä¸€èµ·æ¥è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå­—èŠ‚.

[An online tool](https://www.qqxiuzi.cn/bianma/Unicode-UTF.php)  
[Unicode wikipedia](https://unicode-table.com/cn/)  

### UTF-32

æ‰€æœ‰çš„éƒ½ç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¸è¶³çš„ç”¨0è¡¥é½ï¼Œè¿™æ ·çš„ç¼ºç‚¹å°±æ˜¯æµªè´¹ç©ºé—´ã€‚

## ä½¿ç”¨

ç½‘é¡µç¼–ç ç”¨çš„æ˜¯utf-8ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ç”¨çš„ä¹Ÿæ˜¯utf-8ï¼ŒJavaScriptå¯¹å­—ç¬¦ä¸²çš„ç¼–ç æœ€åˆç”¨çš„æ˜¯`UCS-2` ï¼Œæ˜¯ `UTF-16` çš„å­é›†ï¼Œåæ¥ä»ES6ç”¨çš„å°±æ˜¯ `UTF-16`.

### js å­—ç¬¦ç¼–ç ç›¸å…³çš„api

è·å¾—å¯¹åº”å­—ç¬¦çš„ç ç‚¹ï¼š  
```js
'ğŸƒ'.charCodeAt() // if it exceeds 65536, only display the first two bytes
55356

'ğŸƒ'.codePointAt() // use codePoint get all
127939

new TextEncoder().encode('Ãˆ')  // utf-8
-> Uint8Array(2)Â [195, 136]
```
`Â€` is the `128`th character. so in utf-8, it needs two bytes. It's the first character deserve two bytes, congrats europe dollar!

js é‡Œå¯ä»¥ç›´æ¥ç”¨utf-16æ¥è¡¨ç¤ºå­—ç¬¦ï¼ˆæ³¨æ„ï¼šåœ¨å…¶å®ƒè¯­è¨€é‡Œæœ‰charè¿™ä¸ªç±»å‹ï¼Œjsé‡Œåªæœ‰stringï¼‰ï¼Œåƒè¿™æ ·ï¼š

```js
s='\uD834\uDF06' -> 'ğŒ†'
```

ä¹Ÿå¯ä»¥ç”¨ç ç‚¹æ¥å¾—åˆ°å­—ç¬¦ï¼š

```js
String.fromCharCode(0x597d)->'å¥½'
```

ä½†æ˜¯ï¼Œæ‰©å±•å¹³é¢çš„å­—ç¬¦ä¸èƒ½è¿™ä¹ˆæï¼Œæ¯”å¦‚ï¼š

```js
String.fromCharCode(0x1d306) -> 'íŒ†' //è¿™ä¸ªæ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬çŸ¥é“1d306å¯¹åº”çš„åº”è¯¥æ˜¯'ğŒ†'
String.fromCodePoint(0x1d306) -> 'ğŒ†' // ç”¨è¿™ä¸ªæ–¹æ³•å¾—åˆ°çš„ç»“æœå°±æ˜¯å¯¹çš„
String.fromCharCode(55551) -> '\uD8FF' // è¿™ä¸ªåˆšå¥½å°±æ˜¯ä¸å¯¹åº”ä»»ä½•å­—ç¬¦çš„é‚£ä¸ªåŒºé—´ï¼Œä¹‹é—´è¿”å›unicodeç ç‚¹ï¼Œ55551çš„16è¿›åˆ¶å°±æ˜¯d8ff
```

### ä¸€ä¸ªä¹±ç é—®é¢˜

```js
 fetch('https://img.webmd.com/dtmcms/live/webmd/consumer_assets/site_images/article_thumbnails/other/scoop_on_cat_poop_other/1800x1200_scoop_on_cat_poop_other.jpg?resize=600px:*').then(res => res.text()).then(d => console.log(d))
-> ï¿½ï¿½ï¿½ï¿½\ // åé¢ä¸€å¤§å †çœç•¥
```

è¿™é‡Œå°è¯•æŠŠå›¾ç‰‡çš„äºŒè¿›åˆ¶å½“æ–‡æœ¬æ¥çœ‹å¾…ï¼Œç”¨å­—ç¬¦ç¼–ç è½¬æ¢ï¼Œå°±æ‰¾ä¸åˆ°å¯¹åº”ç¬¦å·ï¼Œå‡ºç°è¿™ç§å…­è¾¹å½¢é‡Œæœ‰ä¸ªï¼Ÿçš„ç¬¦å·ã€‚å›¾ç‰‡çš„äºŒè¿›åˆ¶æ˜¯ä¿å­˜çš„å›¾ç‰‡çš„ä¿¡æ¯ï¼Œé¢œè‰²çº¿æ¡ç­‰ç­‰ï¼Œæ‰€ä»¥åˆ¶ä½œä¸€ä¸ªå›¾ç‰‡æŸ¥çœ‹è½¯ä»¶ä¹Ÿå°±æ˜¯ç”¨è¿™äº›äºŒè¿›åˆ¶æ¥è°ƒåŠ¨è®¡ç®—æœºçš„ç»˜å›¾æ¥å±•ç¤ºå›¾ç‰‡ã€‚

ä¸ºäº†å–å¾—äºŒè¿›åˆ¶ï¼Œåº”è¯¥ç”¨`res.blob()`æ–¹æ³•ï¼š

```js
fetch('https://img.webmd.com/dtmcms/live/webmd/consumer_assets/site_images/article_thumbnails/other/scoop_on_cat_poop_other/1800x1200_scoop_on_cat_poop_other.jpg?resize=600px:*').then(res => res.blob()).then(d => console.log(d))

-> BlobÂ {size: 22098, type: 'image/jpeg'}
         // æˆ–è€…ç”¨arrayBuffer
         fetch('https://img.webmd.com/dtmcms/live/webmd/consumer_assets/site_images/article_thumbnails/other/scoop_on_cat_poop_other/1800x1200_scoop_on_cat_poop_other.jpg?resize=600px:*').then(res => res.arrayBuffer()).then(d => console.log(d))

-> ArrayBuffer(22098)
```



refs:

1. ç»•ä¸è¿‡çš„é˜®è€å¸ˆ[å­—ç¬¦ç¼–ç ç¬”è®°ï¼šASCIIï¼ŒUnicode å’Œ UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)  
2. [Unicodeä¸JavaScriptè¯¦è§£](https://www.ruanyifeng.com/blog/2014/12/unicode.html)